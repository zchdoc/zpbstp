<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon"
			href="https://avatars0.githubusercontent.com/u/17268394?s=400&u=5187f48f142aecaa279593ac514211bcca3ec319&v=4">
	<title>enjs</title>
	<!-- Bootstrap core CSS -->
	<link href="../dist/css/bootstrap.min.css" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="../dist/css/bootstrap-grid.css">
	<link type="text/css" rel="stylesheet" href="../dist/css/bootstrap-reboot.css">
	<link href="../dist/zaddcss/zaddindex.css" rel="stylesheet">
	<style type="text/css">
		#serverAddr {
			width: 60%;
			border-top: none;
			border-left: none;
			border-right: none;
			border-bottom: solid saddlebrown;
		}
	</style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
	<a class="navbar-brand" href="#">Never expand</a>
	<!--<div class="collapse navbar-collapse">-->
	<!--<ul class="navbar-nav mr-auto">-->
	<!--<li class="nav-item active">-->
	<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
	<!--</li>-->
	<!--<li class="nav-item">-->
	<a class="nav-link" href="#">Link</a>
	<!--</li>-->
	<!--<li class="nav-item">-->
	<a class="nav-link disabled" href="#">Disabled</a>
	<!--</li>-->
	<!--<li class="nav-item dropdown">-->
	<a class="nav-link dropdown-toggle" href="https://example.com" id="dropdown06" data-toggle="dropdown"
		aria-haspopup="true" aria-expanded="false">Dropdown</a>
	<div class="dropdown-menu" aria-labelledby="dropdown06">
		<a class="dropdown-item" href="#">Action</a>
		<a class="dropdown-item" href="#">Another action</a>
		<a class="dropdown-item" href="#">Something else here</a>
	</div>
	<!--</li>-->
	<!--</ul>-->
	<form class="form-inline my-2 my-md-0">
		<input class="form-control" type="text" placeholder="Search">
	</form>
	<!--</div>-->
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample01"
			  aria-controls="navbarsExample01" aria-expanded="false" aria-label="Toggle navigation">
		QA<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarsExample01">
		<p>1234567489123456798</p>
		<p>1234567489123456798</p>
		<p>1234567489123456798</p>
		<p>1234567489123456798</p>
	</div>
</nav>
<main role="main">
	<section class="jumbotron text-center">
		<div class="container">
			<h1 class="jumbotron-heading">js加密解密</h1>
			<p class="lead text-muted">测试</p>
			<p>
				<a href="#" class="btn btn-primary my-2">主</a>
				<a href="#" class="btn btn-secondary my-2">次</a>
			</p>
		</div>
	</section>
	<div class="album py-5 bg-light">
		<div class="container">
			<!--<div class="container-fluid" style="padding-bottom: 1rem">-->
			<div class="container-fluid" style="padding-bottom: auto">
				<p>
					密钥：<input name="okey" type="password" value="abc" placeholder="abc" aria-placeholder="abc">
					文字：<input name="otext" type="text" value="12" placeholder="12" aria-placeholder="12">
					加密：<input name="en" type="text" value="" title="加密">
					解密：<input name="de" type="text" value="" title="解密">
				</p>
				<p><input name="gen" type="button" class="btn btn-sm btn-primary" value="加密信息"></p>
				<p>
					服务器地址：<input name="serverAddr" id="serverAddr" class type="text" value="http://1.singbon.com:81"
									 title="服务器地址">
				</p>
				<p>
					<input name="getpwd" type="button" class="btn btn-sm btn-primary" value="获取密码">
					<input name="loadpwd" type="button" class="btn btn-sm btn-primary" value="获取密码" title="打开新的页面">
				</p>
				<p>
					设备号：<input name="deviceNum" type="number" value="1" placeholder="1" aria-placeholder="1">
				</p>
				<p><input name="loadDeviceInfo" type="button" class="btn btn-sm btn-primary" value="查询设备"></p>
			</div>
			<div class="row">
				<div class="col-md-12">
					这个地方什么也没有！
				</div>
			</div>
		</div>
	</div>
</main>
<footer class="text-muted">
	<div class="container">
		<p class="float-right">
			<a href="#">返回最上</a>
		</p>
		<p>示例页面 &copy; Bootstrap!</p>
		<p>
			<a href="https://github.com/zghnzch">访问我们的主页</a>
		</p>
	</div>
</footer>
<script src="../dist/zaddjs/jquery/jquery-3.3.1.min.js"></script>
<script src="../dist/zaddjs/encrypt/src/core.js"></script>
<script src="../dist/zaddjs/encrypt/src/cipher-core.js"></script>
<script src="../dist/zaddjs/encrypt/src/tripledes.js"></script>
<script src="../dist/zaddjs/encrypt/src/mode-ecb.js"></script>
<script type="text/javascript">
	//加密的私钥
	// let 和 Var 有什么区别？
	let key = $('input[name=okey]').val();
	// DES加密
	function encryptByDES(message) {
		key = $('input[name=okey]').val();
		//把私钥转换成16进制的字符串
		let keyHex = CryptoJS.enc.Utf8.parse(key);
		//模式为ECB padding为Pkcs7
		let encrypted = CryptoJS.DES.encrypt(message, keyHex, {
			mode: CryptoJS.mode.ECB,
			padding: CryptoJS.pad.Pkcs7
		});
		//加密出来是一个16进制的字符串
		return encrypted.ciphertext.toString();
	}
	//DES  ECB模式解密
	function decryptByDESModeEBC(ciphertext) {
		//把私钥转换成16进制的字符串
		let keyHex = CryptoJS.enc.Utf8.parse(key);
		//把需要解密的数据从16进制字符串转换成字符byte数组
		let decrypted = CryptoJS.DES.decrypt({
			ciphertext: CryptoJS.enc.Hex.parse(ciphertext)
		}, keyHex, {
			mode: CryptoJS.mode.ECB,
			padding: CryptoJS.pad.Pkcs7
		});
		//以utf-8的形式输出解密过后内容
		return decrypted.toString(CryptoJS.enc.Utf8);
	}
</script>
<script type="text/javascript">
	$(function () {
		let eleInputEn = $("input[name='en']");
		let eleInputDe = $("input[name='de']");
		let eleInputDeviceNum = $("input[name='deviceNum']");
		// btn 加密
		$("input[name='gen']").click(function () {
			//需要加密的内容
			let otext = $("input[name='otext']").val();
			let str3 = encryptByDES(otext);
			let str4 = decryptByDESModeEBC(str3);
			eleInputEn.val(str3);
			eleInputDe.val(str4);
		});
		// btn 获取密码
		$("input[name='getpwd']").click(function () {
			let otext = $("input[name='otext']").val();
			let str3 = encryptByDES(otext);
			let str4 = decryptByDESModeEBC(str3);
			eleInputEn.val(str3);
			eleInputDe.val(str4);
			let url = $("input[name='serverAddr']").val();
			// http://1.singbon.com:81/s/suf.do?s=0ffdb1764642b372
			url = url + "/s/suf.do";
			let data = eleInputEn.val();
			console.log(url);
			$.ajax({
				type: "get",    //请求方式
				async: true,    //是否异步
				url: url,
				dataType: "JSONP",    //跨域json请求一定是jsonp
				// jsonp: "s",    //跨域请求的参数名，默认是callback
				//jsonpCallback:"",    //自定义跨域参数值，回调函数名也是一样，默认为jQuery自动生成的字符串
				crossDomain: true,
				data: {"s": data},    //请求参数
				beforeSend: function () {
					//请求前的处理
				},
				success: function (success) {
					//请求成功处理，和本地回调完全一样
					alert("1 " + success);
					console.log("1 " + success);
				},
				complete: function () {
					//请求完成的处理
				},
				error: function (err) {
					//请求出错处理
					for (let s in err) {
						console.log(err[s]);
					}
				}
			});
		});
		// btn 新页面获取密码
		$("input[name='loadpwd']").click(function () {
			//需要加密的内容
			let otext = $("input[name='otext']").val();
			let str3 = encryptByDES(otext);
			let str4 = decryptByDESModeEBC(str3);
			eleInputEn.val(str3);
			eleInputDe.val(str4);
			let url = $("input[name='serverAddr']").val();
			// http://1.singbon.com:81/s/suf.do?s=0ffdb1764642b372
			let data = eleInputEn.val();
			url = url + "/s/suf.do?s=" + data;
			//window.location.href = url;
			window.open(url);
		});
		// btn 新页面获取设备信息
		$("input[name='loadDeviceInfo']").click(function () {
			let deviceNum = eleInputDeviceNum.val();
			let url = $("input[name='serverAddr']").val();
			// http://smartschool.singbon.com:81/s/s.do?s=9366
			url = url + "/s/s.do?s=" + deviceNum;
			//window.location.href = url;
			window.open(url);
		});
	});
</script>
</body>
</html>
